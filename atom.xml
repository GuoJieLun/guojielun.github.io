<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jay</title>
  
  <subtitle>伟大,源于一个勇敢的开始</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.guojielun.com/"/>
  <updated>2018-02-08T11:53:08.000Z</updated>
  <id>http://blog.guojielun.com/</id>
  
  <author>
    <name>Jay Guo</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>解决 can&#39;t set headers after they are sent</title>
    <link href="http://blog.guojielun.com/2018/02/08/%E8%A7%A3%E5%86%B3-can-t-set-headers-after-they-are-sent/"/>
    <id>http://blog.guojielun.com/2018/02/08/解决-can-t-set-headers-after-they-are-sent/</id>
    <published>2018-02-08T11:44:36.000Z</published>
    <updated>2018-02-08T11:53:08.000Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Feb 09 2018 12:43:27 GMT+0800 (CST) --><p>今天用node测试的 <code>async/await</code> 的接口的时候，发现同一界面,同时发出多个请求的时候会报错<br></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">can<span class="string">'t set headers after they are sent</span></span><br></pre></td></tr></table></figure><p></p><p>然后上网查找资料都是说是没有设置 <code>res.end()</code> 或者 <code>return res.json</code>, 按照网上的方法来设置之后还是没办法解决,后来发现在一个资料里面说是这段代码也会引起报错。<br></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.use(<span class="built_in">require</span>(<span class="string">'express-formidable'</span>)(&#123;</span><br><span class="line">  <span class="comment">// uploadDir: path.join(__dirname, 'public/images'), // 上传文件目录</span></span><br><span class="line">  keepExtensions: <span class="literal">true</span><span class="comment">// 保留后缀</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p></p><p>我注释的这段代码时候，请求不会报错了。但是我还需要用到这个中间件。<br>最后的解决办法是要初始化 <code>express-formidable</code>,<br>代码如下:<br></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm(&#123;</span><br><span class="line">    encoding: <span class="string">'utf-8'</span>,</span><br><span class="line">    <span class="comment">// uploadDir:  path.join(__dirname, '/Upload'),</span></span><br><span class="line">    multiples: <span class="literal">true</span>,</span><br><span class="line">    keepExtensions: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  form.once(<span class="string">'error'</span>, <span class="built_in">console</span>.log)</span><br><span class="line">  form.parse(req, <span class="function"><span class="keyword">function</span> (<span class="params">err, fields, files</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(req, &#123;fields, files&#125;);</span><br><span class="line">    next();</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p></p><h4 id="总结原因"><a href="#总结原因" class="headerlink" title="总结原因"></a>总结原因</h4><p>可能是直接app.use后 <code>express-formidable</code>,当我的接口是异步的时候会导致请求<strong>阻塞</strong>无法及时的 <code>next()</code> 从而导致报错。所有需要 <code>express-formidable</code>的中间件里面监听到数据合并之后需要 <code>next()</code> 这样<code>async/await</code>就可以执行下去了</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Fri Feb 09 2018 12:43:27 GMT+0800 (CST) --&gt;&lt;p&gt;今天用node测试的 &lt;code&gt;async/await&lt;/code&gt; 的接口的时候，发现同一界面,同时发出多个请求的时候会报错&lt;br&gt;&lt;/p&gt;&lt;figur
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>weex环境配置</title>
    <link href="http://blog.guojielun.com/2018/02/07/WEEX%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://blog.guojielun.com/2018/02/07/WEEX环境配置/</id>
    <published>2018-02-07T02:37:55.000Z</published>
    <updated>2018-02-09T01:53:35.000Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Feb 09 2018 12:43:27 GMT+0800 (CST) --><h2 id="配置开发环境"><a href="#配置开发环境" class="headerlink" title="配置开发环境"></a>配置开发环境</h2><ul><li><h4 id="安装weex脚手架"><a href="#安装weex脚手架" class="headerlink" title="安装weex脚手架"></a>安装weex脚手架</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">npm install -g weex-toolkit</span><br></pre></td></tr></table></figure></li><li><h4 id="升级weex版本-不是必须"><a href="#升级weex版本-不是必须" class="headerlink" title="升级weex版本(不是必须)"></a>升级weex版本(不是必须)</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">weex update weex-devtool@latest</span><br></pre></td></tr></table></figure></li><li><h4 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h4><p><code>cd &#39;项目名称&#39;</code><br><code>npm install 或 cnpm install (‘前提是已安装淘宝镜像’)</code></p></li><li><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure></li></ul><h2 id="配置ios环境"><a href="#配置ios环境" class="headerlink" title="配置ios环境"></a>配置ios环境</h2><ul><li><h4 id="集成参考网站"><a href="#集成参考网站" class="headerlink" title="集成参考网站"></a>集成参考网站</h4><p><a href="https://open.taobao.com/doc2/detail?spm=a219a.7629140.0.0.tFddsV&amp;&amp;docType=1&amp;articleId=104829" target="_blank" rel="noopener">参考1</a><br><a href="http://weex.incubator.apache.org/cn/references/advanced/integrate-devtool-to-ios.html" target="_blank" rel="noopener">参考2</a></p></li><li><h4 id="weex添加ios模块"><a href="#weex添加ios模块" class="headerlink" title="weex添加ios模块"></a>weex添加ios模块</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">weex platform add ios</span><br></pre></td></tr></table></figure></li><li><h4 id="安装gem和cocoapods"><a href="#安装gem和cocoapods" class="headerlink" title="安装gem和cocoapods"></a>安装gem和cocoapods</h4><p><a href="https://www.jianshu.com/p/422723a02f95" target="_blank" rel="noopener">参考</a></p></li><li><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><code>cd platforms/ios/</code><br><code>pod install&amp;nbsp</code></li><li><h4 id="回到项目根目录-启动服务"><a href="#回到项目根目录-启动服务" class="headerlink" title="回到项目根目录,启动服务"></a>回到项目根目录,启动服务</h4><code>weex run ios</code></li></ul><h2 id="配置weex-ui"><a href="#配置weex-ui" class="headerlink" title="配置weex-ui"></a>配置weex-ui</h2><ul><li><a href="https://github.com/alibaba/weex-ui" target="_blank" rel="noopener">weex-ui</a></li><li><h4 id="安装weex-ui"><a href="#安装weex-ui" class="headerlink" title="安装weex-ui"></a>安装weex-ui</h4><code>npm install weex-ui —save</code></li><li><h4 id="安装相关依赖插件"><a href="#安装相关依赖插件" class="headerlink" title="安装相关依赖插件"></a>安装相关依赖插件</h4><code>npm i babel-preset-stage-0 babel-plugin-component -D</code></li><li><h4 id="配置-babelrc"><a href="#配置-babelrc" class="headerlink" title="配置.babelrc"></a>配置.babelrc</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  &#123;</span><br><span class="line"> <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"stage-0"</span>],</span><br><span class="line"> <span class="string">"plugins"</span>: [</span><br><span class="line">   [</span><br><span class="line">     <span class="string">"component"</span>,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="string">"libraryName"</span>: <span class="string">"weex-ui"</span>,</span><br><span class="line">       <span class="string">"libDir"</span>: <span class="string">"packages"</span></span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><h4 id="配置完毕-重启服务"><a href="#配置完毕-重启服务" class="headerlink" title="配置完毕,重启服务"></a>配置完毕,重启服务</h4></li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- build time:Fri Feb 09 2018 12:43:27 GMT+0800 (CST) --&gt;&lt;h2 id=&quot;配置开发环境&quot;&gt;&lt;a href=&quot;#配置开发环境&quot; class=&quot;headerlink&quot; title=&quot;配置开发环境&quot;&gt;&lt;/a&gt;配置开发环境&lt;/h
      
    
    </summary>
    
    
  </entry>
  
</feed>
